I"X<h1 id="django-서버-구축">Django 서버 구축</h1>

<p>새로운 환경이라 아직 이해는 잘 안 됩니다. 많이 부족한 부분이 있으니 양해바랍니다.</p>

<h2 id="django-프로젝트-생성">django 프로젝트 생성</h2>

<p>먼저 django를 설치합니다. 설치되어 있으면 버전을 확인해봅니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>python <span class="nt">-m</span> django <span class="nt">--version</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>이후 프로젝트를 생성합니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>django-admin startproject sitename
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>sitename
    <ul>
      <li>manage.py</li>
      <li>sitename
        <ul>
          <li>__init__.py</li>
          <li>settings.py</li>
          <li>urls.py</li>
          <li>asgi.py</li>
          <li>wsgi.py</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>이렇게 생성되는데요. manage.py는 프로젝트 생성했던 <code class="language-plaintext highlighter-rouge">django-admin</code>이나 <code class="language-plaintext highlighter-rouge">python manage.py [...]</code>처럼 다양한 명령을 내릴 수 있게 하고, 프로젝트와 상호작용하는 커멘드라인 유틸리티(django의 명령줄 유틸리티)입니다.</p>

<p>프로젝트 생성 후 <code class="language-plaintext highlighter-rouge">sitename</code>으로 폴더가 생성되고, 내부에 같은 이름의 폴더가 더 생깁니다.</p>

<p>최상위 프로젝트 폴더는 vue나 react에서 프로젝트 만들고 나면 생기는 최상위 폴더처럼 이름을 바꾸거나 해도 상관없습니다.</p>

<p>내부에 있는 <code class="language-plaintext highlighter-rouge">sitename/</code>폴더는 python 패키지들이 저장되고, 디텍토리 이름을 이용해서 프로젝트 내에서 python 패키지들을 임포트 가능하게 합니다.</p>

<p>예를 들면, 데이터베이스를 만들고나서 <code class="language-plaintext highlighter-rouge">settings.py</code>에서 디렉토리를 등록할 때 <code class="language-plaintext highlighter-rouge">INSTALLED_APPS</code>에 명칭을 넣거나 <code class="language-plaintext highlighter-rouge">sitename/urls.py</code>에서 <code class="language-plaintext highlighter-rouge">urlpatterns</code>를 설정할 때 등에 사용이 됩니다.</p>

<p><code class="language-plaintext highlighter-rouge">sitename/__init__.py</code>는 아직 잘 모르겠습니다. 패키지 관련 문서를 읽어라 되어 있지만 아직 중요하지 않으므로 패스.</p>

<p><code class="language-plaintext highlighter-rouge">sitename/settings.py</code>는 <code class="language-plaintext highlighter-rouge">vue</code>로 따지면 <code class="language-plaintext highlighter-rouge">vue.config.js</code>와 유사합니다. 프로젝트의 환경이나 구성을 조정합니다.</p>

<p>그 외 나머지는 다음에 차차 알아보겠습니다.</p>

<h2 id="페이지-생성">페이지 생성</h2>

<p>서버를 구축해서 필요하다고 생각 되는 것 위주로 단계를 건너뛰었습니다.</p>

<p>개인적으로 필요하다고 생각되는 기본이 페이지 생성과 연결, 데이터베이스 조작 및 연결 이라 생각합니다.</p>

<p>페이지는 <code class="language-plaintext highlighter-rouge">sitename/urls.py</code>에서 설정합니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c1"># sitename/urls.py
</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'blog.urls'</span><span class="p">)),</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="p">.</span><span class="n">site</span><span class="p">.</span><span class="n">urls</span><span class="p">),</span>
<span class="p">]</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>위 처럼 생겼습니다. path 함수에 대한 인자들의 설명은 공홈에 잘 설명되어 있어서 현재 보이는 두 가지만 짚고 넘어가겠습니다.</p>

<p>첫 번째 인자로는 경로입니다. 앞에 &#8220;/&#8221;를 제외하고 붙입니다. 빈 문자열로 두면 <code class="language-plaintext highlighter-rouge">localhost:8000/</code>와 같습니다. <code class="language-plaintext highlighter-rouge">admin/</code>이면 <code class="language-plaintext highlighter-rouge">localhost:8080/admin/</code>이 됩니다. 이 인자를 <code class="language-plaintext highlighter-rouge">route</code>라고 합니다.</p>

<p>두 번째 인자는 <code class="language-plaintext highlighter-rouge">view</code>입니다. 장고에서 일치하는 패턴을 찾으면 특정 <code class="language-plaintext highlighter-rouge">view</code>함수를 호출한다고 합니다. 경로에 맞는 페이지 찾아서 보여준다고 생각하면 될 것 같습니다.</p>

<p>여기서 끝이 아닙니다. 다음으로 <code class="language-plaintext highlighter-rouge">urls.py</code>를 한 번 더 설정해줘야합니다.</p>

<p>장고에서 프로젝트는 환경으로 보고, <code class="language-plaintext highlighter-rouge">app</code>은 어떠한 작업을 수행하는 웹 애플리케이션을 말합니다. 예를 들어 <code class="language-plaintext highlighter-rouge">blog</code>라는 앱을 생성한다고 가정하겠습니다.</p>

<p>경로는 sitename/에서 아래의 명령을 하면 blog라는 폴더가 생성됩니다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>python manage.py startapp blog
</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">sitename/blog/</code> 폴더에는 루트에 있는 설정파일과 유사한 것들이 생성됩니다. 이때 우리가 만들어줘야 하는 것이 있는데요. <code class="language-plaintext highlighter-rouge">urls.py</code>와 <code class="language-plaintext highlighter-rouge">static/</code> 폴더(선택), <code class="language-plaintext highlighter-rouge">templates/blog/</code>(&#8220;s&#8221; 누락 주의)입니다.</p>

<p><code class="language-plaintext highlighter-rouge">templates/blog</code>에서 페이지들을 만들고 레이아웃을 짭니다.</p>

<p><code class="language-plaintext highlighter-rouge">static</code>은 리소스들을 저장해두고, <code class="language-plaintext highlighter-rouge">urls.py</code>는 아까 루트의 <code class="language-plaintext highlighter-rouge">urls.py</code>설정에 이어서 설정해야하는 파일입니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="c1"># sitename/blog/urls.py
</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="n">views</span><span class="p">.</span><span class="n">post_list</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">'post_list'</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'a/'</span><span class="p">,</span> <span class="n">views</span><span class="p">.</span><span class="n">test</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">'a'</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'post/&lt;int:pk&gt;/'</span><span class="p">,</span> <span class="n">views</span><span class="p">.</span><span class="n">post_detail</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">'post_detail'</span><span class="p">),</span>
<span class="p">]</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>아까 짰던 루트의 <code class="language-plaintext highlighter-rouge">urls.py</code>는 <code class="language-plaintext highlighter-rouge">baseurl</code>처럼 최상위 경로를 설정한 것이고, <code class="language-plaintext highlighter-rouge">blog/urls.py</code>는 <code class="language-plaintext highlighter-rouge">blog</code>앱의 하위 경로를 설정합니다. <code class="language-plaintext highlighter-rouge">''</code>으로 비워두면 루트의 <code class="language-plaintext highlighter-rouge">urls.py</code>가 만일 <code class="language-plaintext highlighter-rouge">admin/</code>일 때 <code class="language-plaintext highlighter-rouge">localhost:8000/admin/</code>이 되고 위의 경로와 같이 <code class="language-plaintext highlighter-rouge">''</code>일 때 하위 경로도 <code class="language-plaintext highlighter-rouge">''</code>이면 <code class="language-plaintext highlighter-rouge">localhost:8000/</code>이 됩니다.</p>

<p><code class="language-plaintext highlighter-rouge">''</code>경로 아래 <code class="language-plaintext highlighter-rouge">'a/'</code>는 <code class="language-plaintext highlighter-rouge">localhost:8000/a/</code>가 됩니다. 그리고 <code class="language-plaintext highlighter-rouge">views.py</code>에 있는 <code class="language-plaintext highlighter-rouge">test</code>함수를 인자로 주는 것 입니다.</p>

<p>그리고 <code class="language-plaintext highlighter-rouge">&lt;int:pk&gt;</code>는 <code class="language-plaintext highlighter-rouge">spring</code>으로 볼 때 <code class="language-plaintext highlighter-rouge">@PathVariable("num")</code>과 유사합니다. <code class="language-plaintext highlighter-rouge">localhost:8000/post/1/</code> 경로에 꼬리를 물고 나갈 때 해당 경로 값을 pk로 사용할 수 있습니다.</p>

<p>이 pk를 사용하려면 아래 코드를 참고하면 됩니다.</p>

<p>{%raw%}</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'post_detail' pk=post.pk %}"</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>html의 url 옆에 있는 텍스트는</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c1"># sitename/blog/urls.py
</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
  <span class="c1"># ...
</span>  <span class="n">path</span><span class="p">(</span><span class="s">'post/&lt;int:pk&gt;/'</span><span class="p">,</span> <span class="n">views</span><span class="p">.</span><span class="n">post_detail</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">'post_detail'</span><span class="p">),</span>
<span class="p">]</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">blog/urls.py</code>에서 라우트 설정할 때 지정한 <code class="language-plaintext highlighter-rouge">name</code>과 같아야합니다. 그러면 <code class="language-plaintext highlighter-rouge">pk=post.pk</code>라 할 때 a태그의 경로가 <code class="language-plaintext highlighter-rouge">/post/:pk/</code>가 됩니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">post_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
    <span class="n">post</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Info</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'blog/post_detail.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'post'</span><span class="p">:</span> <span class="n">post</span><span class="p">})</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>이제 <code class="language-plaintext highlighter-rouge">views.py</code>를 설정하겠습니다. 화면을 렌더링할 때 방법이 몇 가지 있는 것 같습니다. <code class="language-plaintext highlighter-rouge">Spring</code>을 예로 들면 <code class="language-plaintext highlighter-rouge">@ResponseBody</code>나 <code class="language-plaintext highlighter-rouge">@RestController</code> 혹은 <code class="language-plaintext highlighter-rouge">tiles</code>를 쓰지 않고 컨트롤러에서 <code class="language-plaintext highlighter-rouge">return</code>값을 텍스트로 주는 등의 방법들 처럼요.</p>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">pk</code>라는 명칭은 처음에 설정한 <code class="language-plaintext highlighter-rouge">&lt;int:pk&gt;</code>의 이름과 <code class="language-plaintext highlighter-rouge">views.py</code>에 지정한 인수의 명칭, 그리고 <code class="language-plaintext highlighter-rouge">a</code>태그에 <code class="language-plaintext highlighter-rouge">name</code>옆에 지정하는 <code class="language-plaintext highlighter-rouge">pk</code>명칭과 같아야 합니다. 셋 중 하나라도 틀리면 오작동 합니다.</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">loader</span>

<span class="c1"># 방법 1 -&gt; 단순히 텍스트를 응답해 줌
</span><span class="k">def</span> <span class="nf">post_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">"&lt;div&gt;안녕, 세계!&lt;/div&gt;"</span><span class="p">)</span>

<span class="c1"># 방법 2 -&gt; 컨텍스트 같이 보내줌
</span><span class="k">def</span> <span class="nf">post_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
  <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'kimson'</span><span class="p">}</span>
  <span class="n">template</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="n">get_template</span><span class="p">(</span><span class="s">'blog/post_list.html'</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">template</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">))</span>

<span class="c1"># 방법 3 -&gt; 더 보기 쉽게 request와 렌더링 할 파일 경로, 컨텍스트를 보내 줌
</span><span class="k">def</span> <span class="nf">post_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
  <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'kimson'</span><span class="p">}</span>
  <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'blog/post_list.html'</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<span class="c1"># blog/post_list.html파일의 내용이 렌더링 됨
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>여기서 sqlite3를 사용한 예로 데이터베이스를 가져와 페이지에 전달하는 것을 적어두려합니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Info</span>

<span class="k">def</span> <span class="nf">post_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
  <span class="n">post</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Info</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'blog/post_list.html'</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p>get_object_or_404는 이후 404 페이지를 커스터마이징 할 때 사용한다고 합니다. 이 내용은 추후에.</p>
</blockquote>

<h2 id="장고-템플릿-문법">장고 템플릿 문법</h2>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>{% extends "path/index.html" %} 해당 경로에 block을 넣는다.

{% block title %} {{ info.title }} {% endblock %}
{% block content %}
  {% for post in posts %}
    <span class="nt">&lt;h1&gt;</span>{{ post.title }}<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{{ post.url }}"</span><span class="nt">&gt;</span>{{ post.headline | upper }}<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      {{ post.content | truncatewords: 100, '...' }}
    <span class="nt">&lt;/p&gt;</span>
  {% endfor %}
{% endblock %}
</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">jekyll liquid</code>와 유사해서 좋네요. 대문자로 바꾼다던지, 문자열을 잘라낸다던지 등의 문법이 오히려 쉽게 접하기 쉽게 다가옵니다.</p>

<p>이제 다음으로 <code class="language-plaintext highlighter-rouge">sqlite</code>는 사용법을 좀 익히고나서 <code class="language-plaintext highlighter-rouge">postgre</code>를 알고자합니다. <code class="language-plaintext highlighter-rouge">mysql</code>이 익숙하지만 <code class="language-plaintext highlighter-rouge">django</code>가 <code class="language-plaintext highlighter-rouge">postgre</code>와 잘 맞는다는 이야기를 듣고 다음에는 <code class="language-plaintext highlighter-rouge">postgre</code>를 연동해서 간단한 게시판 페이지를 만들려합니다. 이상.</p>

<p>{%endraw%}</p>

<hr />

<p>📚 함께 보면 좋은 내용</p>

<p><a href="https://docs.djangoproject.com/en/4.0/ref/templates/language/">Django :: Documentation</a></p>

<p><a href="https://tutorial.djangogirls.org/ko/django_templates/">Django tutorial :: 장고 템플릿</a></p>

<p><a href="https://angel-jinsu.tistory.com/5">천사진수님 :: Django Template Does Not Exist</a></p>

<p><a href="https://doorbw.tistory.com/183">Tigercow.Door님 :: 장고(django) #3_ django에서 postgreSQL 사용하기</a></p>
:ET