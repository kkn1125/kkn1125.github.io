---
slug: "/spring-jpa01/"
layout: post
modified: 2022-03-14 00:09:35 +0900
date:   2021-12-28 22:23:21 +0900
title:  "[SPRING] Springì—ì„œ JPAë¥¼ ì‚¬ìš©í•´ë³´ì"
author: Kimson
categories: [ spring ]
image: /images/post/covers/TIL-spring.png
tags: [ jpa, hibernate, til ]
description: "Spring Bootë§ê³  Springì—ì„œ JPAë¥¼ ì‚¬ìš©í•´ë³´ì

ì´ë²ˆì—ëŠ” `JPA`ë¥¼ `Spring`ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ê¸°ë¡í•˜ë ¤í•©ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ ë¸”ë¡œê·¸ê°€ `Spring Boot`ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…ë˜ì–´ ìˆì–´ `Spring Framework`ë¡œ `JPA`ë¥¼ êµ¬í˜„í•˜ëŠ”ë° ì¡°ê¸ˆ ì–´ë ¤ì›€ì„ ê²ªë‹¤ê°€ ê²°êµ­ `Spring`ê³µì‹ í™ˆí˜ì´ì§€ ë“±ì„ í†µí•´ ì›ë¬¸ì„ ì½ì–´ê°€ë©° ì‘ë™ì€ ì‹œì¼°ìŠµë‹ˆë‹¤."
featured: true
hidden: false
rating: 5
toc: true
profile: false
istop: true
keysum: false
keywords: ""
published: true
---

# Spring Bootë§ê³  Springì—ì„œ JPAë¥¼ ì‚¬ìš©í•´ë³´ì

ì´ë²ˆì—ëŠ” `JPA`ë¥¼ `Spring`ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ê¸°ë¡í•˜ë ¤í•©ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ ë¸”ë¡œê·¸ê°€ `Spring Boot`ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…ë˜ì–´ ìˆì–´ `Spring Framework`ë¡œ `JPA`ë¥¼ êµ¬í˜„í•˜ëŠ”ë° ì¡°ê¸ˆ ì–´ë ¤ì›€ì„ ê²ªë‹¤ê°€ ê²°êµ­ `Spring`ê³µì‹ í™ˆí˜ì´ì§€ ë“±ì„ í†µí•´ ì›ë¬¸ì„ ì½ì–´ê°€ë©° ì‘ë™ì€ ì‹œì¼°ìŠµë‹ˆë‹¤.

## í•„ìš”í•œ ì„¤ì •

{:.blockquote.blockquote-info}
> í•„ìš”í•œ `Dependency`ë¥¼ ë¨¼ì € ì—°ê²°í•©ë‹ˆë‹¤.  
> ì‚¬ìš©ëœ ë‚´ìš©ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

1. `spring-data-jpa` &#8594; `2.4.8` (`springframework`ë¥¼ `5.3.6`ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤ë©´ `2.4.8`ë¡œ ë§ì¶°ì•¼ ì‘ë™í•©ë‹ˆë‹¤.)
2. `hibernate-core` &#8594; `5.3.6.Final`
3. `javax.persistence-api` &#8594; `2.2`
4. `mysql-connector-java` &#8594; `8.0.23`
5. `spring-jdbc` &#8594; `5.3.6`
7. lombok &#8594; `1.18.22`

`lombok`ì€ ì„ íƒì‚¬í•­ì…ë‹ˆë‹¤.

## ì½”ë“œ ì‘ì„±

ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì ë‹¹íˆ ê°„ë‹¨í•œ ì˜ˆì œë¡œ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤.

```sql
create database test;

use test;

create table member(
	mbr_no bigint not null auto_increment,
    id varchar(200),
    name varchar(200),
    primary key(mbr_no)
)default charset="UTF8";

insert into member (id, name) values ("kimson01","kimson1");
insert into member (id, name) values ("kimson02","kimson2");
insert into member (id, name) values ("kimson03","kimson3");
```

`member`í…Œì´ë¸”ì„ ë§Œë“¤ì–´ `JPA`ê°€ ì˜ ì—°ê²°ë˜ê³  ì˜ ì‘ë™ë˜ëŠ”ì§€ê°€ ëª©í‘œì…ë‹ˆë‹¤.

### VO êµ¬í˜„

ë¡¬ë³µìœ¼ë¡œ í•„ìš”í•œ ì •ë³´ë§Œ ê°€ì ¸ì˜¤ë„ë¡ í•©ë‹ˆë‹¤.

```java
@Data
@AllArgsConstructor
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Entity(name = "member") // sqlë¡œ ìƒì„±í•œ tableëª…ê³¼ ë™ì¼í•˜ê²Œ í•©ë‹ˆë‹¤.
public class Member {
	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private Long mbrNo;
	
	private String id;
	private String name;
	
	@Builder
	public Member(String id, String name) {
		this.id = id;
		this.name = name;
	}
}
```

### Config êµ¬í˜„

ì €ëŠ” ê¸°ì¡´ì— `RootConfig`ë¼ëŠ” `dataSource`ë¥¼ `Bean`ìœ¼ë¡œ ë“±ë¡í•˜ëŠ” `Configuration`ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

ê¸°ì¡´ì— `MyBatis`ë¥¼ ì“¸ ë•Œ ë˜ëŠ” `JDBC`ì‚¬ìš© ì‹œ ì½”ë“œ í˜•íƒœëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```java
@Configuration
@ComponentScan("com.springtest.web")
public class RootConfig{
    @Bean
    public DataSource dataSource(){
        DriverManagerDataSource mysql = new DriverManagerDataSource();
        mysql.setDriverClassName("com.mysql.cj.jdbc.Driver");
        mysql.setUrl("jdbc:mysql://localhost:3306/test");
        mysql.setUsername("yourName");
        mysql.setPassword("yourPass");
        return mysql;
    }
}
```

`Spring` í”„ë¡œì íŠ¸ì—ì„œ `JPA`ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ `EntityManager` ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤. ì´í›„ ì‚¬ìš©í•  `JpaRepository`ë¥¼ ìœ„í•´ `EntityManagerFactory`ë¡œ ì¢…ì†ì„± ì£¼ì…ì„ í•´ì•¼í•˜ë¯€ë¡œ `Bean`ì„ ìƒì„±í•´ì„œ ê¸°ë³¸ ì„¤ì •ì„ ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤. (`LocalEntityManagerFactoryBean`ì„ ì‚¬ìš©í•´ë„ ë˜ì§€ë§Œ `LocalContainerEntityManagerFactoryBean`ë¥¼ ì‚¬ìš©í•˜ë©´ ë” ìœ ì—°í•˜ë‹¤ê³  í•©ë‹ˆë‹¤.)

```java
// RootConfig.java
@Configuration
@EnableTransactionManagement
@EnableJpaRepositories("your.repository.package.path")
public class RootConfig {
    @Bean
    public LocalContainerEntityManagerFactoryBean entityManagerFactory() {
        HibernateJpaVendorAdapter vendorAdapter = new HibernateJpaVendorAdapter();
		vendorAdapter.setDatabase(Database.HSQL);
		vendorAdapter.setGenerateDdl(true);

		LocalContainerEntityManagerFactoryBean em = new LocalContainerEntityManagerFactoryBean();
		em.setDataSource(dataSource());
		em.setPackagesToScan(new String[] {"com.springtest.web"});
		em.setJpaVendorAdapter(vendorAdapter);
		em.setJpaProperties(additioanlProperties());
		
		return em;
	}

    @Bean
	public PlatformTransactionManager transactionManager() {
		JpaTransactionManager transactionManager = new JpaTransactionManager();
		transactionManager.setEntityManagerFactory(entityManagerFactory().getObject());
		
		return transactionManager;
	}

    @Bean
	public PersistenceExceptionTranslationPostProcessor excetionTranslation() {
		return new PersistenceExceptionTranslationPostProcessor();
	}

    Properties additioanlProperties() {
        // í”„ë¡œí¼í‹°ì¦ˆ ì„¤ì •í•˜ì—¬ entityManagerFactory ë©”ì„œë“œì—ì„œ í˜¸ì¶œ
		Properties properties = new Properties();
		properties.setProperty("hibernate.hbm2ddl.auto", "create-drop");
		properties.setProperty("hibernate.dialect", "org.hibernate.dialect.MySQL5Dialect");
		return properties;
	}

    @Bean // ê¸°ì¡´ì˜ ë°ì´í„°ì†ŒìŠ¤
    public DataSource dataSource(){
        DriverManagerDataSource mysql = new DriverManagerDataSource();
        mysql.setDriverClassName("com.mysql.cj.jdbc.Driver");
        mysql.setUrl("jdbc:mysql://localhost:3306/test");
        mysql.setUsername("yourName");
        mysql.setPassword("yourPass");
        return mysql;
    }
}
```

`Config`êµ¬í˜„ì€ ì—¬ê¸°ê°€ ëì…ë‹ˆë‹¤.

### Repository êµ¬í˜„

```java
// MemberRepository.java
@Repository
public interface MemberRepository extends JpaRepository<Member, Long> {
	public List<Member> findById(String id);
}
```

í…ŒìŠ¤íŠ¸ìš©ì´ë¯€ë¡œ `findById`ë§Œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

### Service êµ¬í˜„

```java
// MemberService.java
@Service
public class MemberService {
	
	@Autowired
	private MemberRepository memberRepository;
	
	public List<Member> findAll(){
		List<Member> members = new ArrayList<>();
		List<Member> list = memberRepository.findAll();
		System.out.println(list);
		return members;
	}
}
```

ì „ì²´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒìœ¼ë¡œ êµ¬í˜„í•´ ë†“ê³  `Controller`ê¹Œì§€ ê°„ë‹¨í•˜ê²Œ ì‘ì„±í•©ë‹ˆë‹¤.

### Controller êµ¬í˜„

```java
// HomeController.java
@Controller("/")
public class HomeController {
	@Autowired
	public MemberService service;
	
	@GetMapping("")
	public String home(Locale locale, Model model) {
		service.findAll();
		return "root.home";
	}
}
```

## í…ŒìŠ¤íŠ¸

`member`í…Œì´ë¸”ì— í•œ ë‘ ê°€ì§€ ì •ë„ ë¡œìš°ë¥¼ ì¶”ê°€í•´ì„œ ì‹¤í–‰í•´ë´…ë‹ˆë‹¤.

ê²°ê³¼ëŠ” ë§Œì¡±ìŠ¤ëŸ½ê²Œë„ ì˜ ì‘ë™í•©ë‹ˆë‹¤ :)

í˜„ì¬ ë¹ ë¥´ê²Œ ê¸°ë¡í•˜ê¸° ìœ„í•´ ì°¸ê³ í•œ ì›ë¬¸ ì‚¬ì´íŠ¸ ë“±ì„ ì•„ë˜ì— ë§í¬ë¡œ ë‚¨ê²¼ìŠµë‹ˆë‹¤. ë¶ˆí•„ìš”í•œ ì½”ë“œê°€ ì—†ëŠ”ì§€ ì´ ë°©ë²•ì´ ë§ëŠ”ì§€ì— ëŒ€í•œ ì •ë³´ë¥¼ ë” ì–»ì€ í›„ì— í¬ìŠ¤íŠ¸ë¥¼ ìˆ˜ì •í•  ì˜ˆì •ì…ë‹ˆë‹¤.

ì˜ëª»ëœ ë‚´ìš©ì´ ìˆë‹¤ë©´ ì•Œë ¤ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤ :)

-----

ğŸ“š í•¨ê»˜ ë³´ë©´ ì¢‹ì€ ë‚´ìš©

[DOCS Spring 2.JPA Repositories](https://docs.spring.io/spring-data/jpa/docs/1.5.0.RELEASE/reference/html/jpa.repositories.html)

[Spring.io ë¬¸ì„œ - Book Example](https://spring.io/projects/spring-data-jpa#samples)

[odrotbohm - A Guide to JPA with Spring](https://www.baeldung.com/the-persistence-layer-with-spring-and-jpa)

[Baeldung - spring-projects/spring-data-book](https://github.com/spring-projects/spring-data-book/blob/master/jpa/src/main/java/com/oreilly/springdata/jpa/core/CustomerRepository.java)

[fdpro - Github Repository::tutorials](https://github.com/eugenp/tutorials/blob/master/persistence-modules/spring-jpa-2/src/main/resources/hibernate5Configuration.xml)

[devkumaë‹˜ - [Spring] JpaRepository ì´ìš©](https://araikuma.tistory.com/329)

[ê°“ëŒ€í¬ë‹˜ - [ìŠ¤í”„ë§ë¶€íŠ¸ (7)] Spring Boot JPA(1) - ì‹œì‘ ë° ê¸°ë³¸ ì„¤ì •](https://goddaehee.tistory.com/209)

[Cristovalë‹˜ - [Spring + JPA] Spring Data JPA ë€? (1)](https://data-make.tistory.com/621)
