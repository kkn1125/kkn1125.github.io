---
slug: "/next-auth01/"
layout: post
modified: 2023-04-08 16:57:33 +0000
date: 2022-06-07 22:47:45 +0000
title: "[NEXT.js] Next-Auth ê¸°ë³¸ ì‚¬ìš© 01"
author: Kimson
categories: [next]
image: /images/post/covers/nextjs-black-logo.svg
tags: [next, auth, til]
description: "Next-Authë¥¼ ì‚¬ìš©í•´ë³´ì

Next authëŠ” next.js ì•±ì— ì¸ì¦ì„ ì¶”ê°€í•´ì£¼ëŠ” ê³ ë§ˆìš´ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤. NextAuth.js í™ˆí˜ì´ì§€ì—ì„œë„ ë”°ë¼í•˜ê¸° ì‰½ê³ , ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” apië‚˜ optionì— ëŒ€í•´ì„œë„ ë³´ê¸° ì¢‹ê²Œ ì •ë¦¬ë˜ì–´ ìˆë‹¤.

ì´ë²ˆì— í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ ìœ ì € ì¸ì¦ì„ êµ¬í˜„í•´ì•¼ í•  ì¼ì´ ìƒê²¼ë‹¤. MongoDB ë˜í•œ ì²˜ìŒ ì‚¬ìš©í•˜ë©´ì„œ ì—¬ëŸ¬ê°€ì§€ ë°°ìš¸ ë¶€ë¶„ë„ ë§ê³ , jwt(Json Web Token)ë„ ì²˜ìŒ ì¨ë³´ë©´ì„œ ì§„ì§œ ë¨¸ë¦¬ê°€ í„°ì ¸ë‚˜ê°ˆ ê²ƒë§Œ ê°™ì§€ë§Œ, í•˜ë‚˜ ì”© ë™ì‘í•˜ëŠ” ê±¸ ë³¼ ë•Œë§ˆë‹¤ ê¸°ë¶„ì´ ì¢‹ìœ¼ë‹ˆ ì°¸ê¸°ë¡œ í•œë‹¤."
featured: true
hidden: false
rating: 4.5
toc: true
profile: false
istop: true
keysum: false
keywords: ""
published: true
---

# Next-Authë¥¼ ì‚¬ìš©í•´ë³´ì

Next authëŠ” next.js ì•±ì— ì¸ì¦ì„ ì¶”ê°€í•´ì£¼ëŠ” ê³ ë§ˆìš´ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤. NextAuth.js í™ˆí˜ì´ì§€ì—ì„œë„ ë”°ë¼í•˜ê¸° ì‰½ê³ , ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” apië‚˜ optionì— ëŒ€í•´ì„œë„ ë³´ê¸° ì¢‹ê²Œ ì •ë¦¬ë˜ì–´ ìˆë‹¤.

ì´ë²ˆì— í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ ìœ ì € ì¸ì¦ì„ êµ¬í˜„í•´ì•¼ í•  ì¼ì´ ìƒê²¼ë‹¤. MongoDB ë˜í•œ ì²˜ìŒ ì‚¬ìš©í•˜ë©´ì„œ ì—¬ëŸ¬ê°€ì§€ ë°°ìš¸ ë¶€ë¶„ë„ ë§ê³ , jwt(Json Web Token)ë„ ì²˜ìŒ ì¨ë³´ë©´ì„œ ì§„ì§œ ë¨¸ë¦¬ê°€ í„°ì ¸ë‚˜ê°ˆ ê²ƒë§Œ ê°™ì§€ë§Œ, í•˜ë‚˜ ì”© ë™ì‘í•˜ëŠ” ê±¸ ë³¼ ë•Œë§ˆë‹¤ ê¸°ë¶„ì´ ì¢‹ìœ¼ë‹ˆ ì°¸ê¸°ë¡œ í•œë‹¤.

## ì‘ì—… í™˜ê²½

> 2022-06-08 ê¸°ì¤€

- react: v18.1.0
- next: v12.1.6,
- next-auth: v4.3.4
- MongoDB: v5.3.1 (shell)
- mongoose: v6.3.5
- axios: v0.27.2

## ê¸°ì¡´ í”„ë¡œì íŠ¸ì— ì¶”ê°€í•˜ëŠ” ë°©ë²•

ë¨¼ì € `next-auth`ì˜ ì‘ë™ì›ë¦¬ë¥¼ ì•Œì•„ì•¼í•œë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ ì‘ë™ì€ `next`ì˜ `dynamic routes`ë¥¼ ì‚¬ìš©í•œë‹¤.

nextì˜ dynamic routesì— ëŒ€í•´ ëª¨ë¥¸ë‹¤ë©´ [ì´ ë§í¬](https://nextjs.org/docs/routing/dynamic-routes) ë¥¼ ë¨¼ì € ì°¸ê³ í•˜ì.

```jsx
// pages/api/auth/[...nextauth].js

import NextAuth from "next-auth";
import GithubProvider from "next-auth/providers/github";

export default NextAuth({
  // Configure one or more authentication providers
  providers: [
    GithubProvider({
      clientId: process.env.GITHUB_ID,
      clientSecret: process.env.GITHUB_SECRET,
    }),
    // ...add more providers here
  ],
});
```

ìœ„ì˜ ì˜ˆì‹œì²˜ëŸ¼ ì‘ì„±í•´ì„œ ì“´ë‹¤. ì˜ˆì‹œ ë‚´ìš©ì€ Githubë¡œê·¸ì¸ êµ¬í˜„ì— ì‚¬ìš©ë˜ëŠ” ì˜ˆì‹œì´ê³  ì•„ì§ í™œìš©í•´ë³´ì§€ëŠ” ëª»í–ˆìœ¼ë‹ˆ ë‹¤ìŒ ê¸°íšŒì— ë‹¤ë¤„ë³´ê¸°ë¡œ í•˜ì.

ë‚´ê°€ ì´ë²ˆì— ì •ë¦¬í•˜ê³  ë‹¤ë£° ë‚´ìš©ì€ `**CredentialsProvider**` ë¶€ë¶„ì´ë‹¤. ì˜ˆì‹œ ì„¸íŒ…ì€ ì•„ë˜ì™€ ê°™ë‹¤.

```jsx
// pages/api/auth/[...nextauth].js

import CredentialsProvider from "next-auth/providers/credentials";

export default NextAuth({
  // Configure one or more authentication providers
  providers: [
    // ...ë‹¤ë¥¸ providerë¥¼ ì¶”ê°€í•˜ë©´ ëœë‹¤.
    CredentialsProvider({
      id: "username-password-credentials",
      // The name to display on the sign in form (e.g. 'Sign in with...')
      name: "Credentials",
      // The credentials is used to generate a suitable form on the sign in page.
      // You can specify whatever fields you are expecting to be submitted.
      // e.g. domain, username, password, 2FA token, etc.
      // You can pass any HTML attribute to the <input> tag through the object.
      credentials: {
        username: { label: "Username", type: "text", placeholder: "jsmith" },
        password: { label: "Password", type: "password" },
      },
      async authorize(credentials, req) {
        // You need to provide your own logic here that takes the credentials
        // submitted and returns either a object representing a user or value
        // that is false/null if the credentials are invalid.
        // e.g. return { id: 1, name: 'J Smith', email: 'jsmith@example.com' }
        // You can also use the `req` object to obtain additional parameters
        // (i.e., the request IP address)
        const res = await fetch("/your/endpoint", {
          method: "POST",
          body: JSON.stringify(credentials),
          headers: { "Content-Type": "application/json" },
        });
        const user = await res.json();

        // If no error and we have user data, return it
        if (res.ok && user) {
          return user;
        }
        // Return null if user data could not be retrieved
        return null;
      },
    }),
  ],
  pages: {
    // ...
  },
  callbacks: {
    // ...
  },
});
```

ë¨¼ì € `CredentialsProvider`ëŠ” ë¡œê·¸ì¸ êµ¬í˜„ ë•Œ ì‚¬ìš©ë˜ëŠ” ê²ƒì¸ë°, í•˜ë‚˜ ì”© ë³´ì.

1. id: ì•„ì´ë””ëŠ” ë‚´ê°€ ë‚˜ì¤‘ì— ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” ì¸ì¦ Providerë¥¼ ê³¨ë¼ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì´ë¦„ì •ë„ë¡œ ë³´ë©´ ëœë‹¤.
2. name: `/api/auth/signin` ê²½ë¡œë¡œ ì ‘ì†í•˜ê²Œ ë˜ë©´ ë‚˜ì˜¤ëŠ” ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ ë¡œê·¸ì¸ ë²„íŠ¼ì— ë„ì–´ì§€ëŠ” `"Sign in with [name]"`ì˜ í…ìŠ¤íŠ¸ ë¶€ë¶„ì´ë‹¤. ì¦‰, submit ë²„íŠ¼ í…ìŠ¤íŠ¸ì´ë‹¤.
3. credentials: í•´ë‹¹ providerë¥¼ ì‚¬ìš©í•  ë•Œ ì¸ì¦ í•  ìš”ì†Œë¥¼ ì„ íƒí•˜ëŠ” ë¶€ë¶„ì´ë‹¤. ë§ˆì°¬ê°€ì§€ë¡œ `/api/auth/signin` ê²½ë¡œë¡œ ì ‘ì†í•˜ë©´ ë‚˜ì˜¤ëŠ” input fieldì— í•´ë‹¹í•œë‹¤.
4. authorize: ì‹¤ì§ˆì ìœ¼ë¡œ ë¡œê·¸ì¸ ì²˜ë¦¬ê°€ ë˜ëŠ” ë¡œì§ë¶€ë¶„ì´ë‹¤. `credentials`ì—ëŠ” ë‚´ê°€ í•´ë‹¹ í•„ë“œì— ì…ë ¥í•œ input nameê³¼ valueê°’ì´ objectë¡œ ë“¤ì–´ì˜¤ê²Œ ëœë‹¤. reqì—ëŠ” requsetë‚´ìš© ì „ì²´ê°€ ë“¤ì–´ì˜¨ë‹¤. (body, query, headers... ë“±ë“±)
5. pages: `/api/auth/signin` ë“±ì˜ ê²½ë¡œë¥¼ ë‚´ê°€ ì§€ì •í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤. (ex. `/auth/login`)
6. callbacks: session, jwt, redirect, signIn ë©”ì„œë“œë¥¼ ì¬ì •ì˜í•´ì„œ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë¶€ë¶„ì´ë‹¤.

ì§„ì§œ ì •ë§ ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•œ ë¶€ë¶„ì´ë¼ ê¼­ í™ˆí˜ì´ì§€ë¥¼ ì°¸ì¡°í•´ì„œ ë” ìì„¸í•˜ê²Œ ë³´ê¸°ë¥¼ ë°”ë€ë‹¤.

## ë¡œê·¸ì¸ ì²˜ë¦¬

ìœ„ ì˜ˆì‹œ ì½”ë“œì—ì„œ ë‚˜ëŠ” fetchë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  mongooseë¥¼ ì‚¬ìš©í•˜ì˜€ê¸° ë•Œë¬¸ì— ì¡°ê¸ˆ ë°”ê¾¸ì–´ ë‹¤ì‹œ ë³´ì.

```jsx
// pages/api/auth/[...nextauth].js

import CredentialsProvider from "next-auth/providers/credentials";

export default NextAuth({
  providers: [
    CredentialsProvider({
      id: "username-password-credentials",
      name: "Credentials",
      credentials: {
        username: { label: "Username", type: "text", placeholder: "jsmith" },
        password: { label: "Password", type: "password" },
      },
      async authorize(credentials, req) {
        const { csrfToken, _id } = credentials;

        await dbConnect();

        const user = await User.findOne({
          // collectionì´ë¦„  : credentials ì†ì„± ì´ë¦„
          username: username,
          password: password,
        });

        if (user) {
          console.log("new user", user);
          return user;
        } else {
          return null;
        }
      },
    }),
  ],
});
```

> `dbConnect` êµ¬í˜„ì€ ë‹¤ìŒ ê¸°íšŒì— ë‹¤ë£¨ê¸°ë¡œ í•˜ê² ë‹¤.

ë‚´ìš© ì‘ì„±ì´ ëë‚¬ë‹¤ë©´ ì„œë²„ë¥¼ êµ¬ë™ì‹œí‚¤ê³  [http://localhost:3000/api/auth/signin](http://localhost:3000/api/auth/signin) ë¡œ ì ‘ì†í•˜ë©´ ë§Œë“¤ì§€ë„ ì•Šì•˜ëŠ”ë° ë¡œê·¸ì¸ í˜ì´ì§€ê°€ ëœ¬ë‹¤.

`mongodb`ì— ì„ì‹œë¡œ ìœ ì € ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ë©´ ë¸Œë¼ìš°ì € ê°œë°œìë„êµ¬ì—ì„œ `Application` íƒ­ì— ì¿ í‚¤ë¥¼ ë³´ë©´ `next auth session`ì†ì„±ì´ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.

ì¶”ê°€ëœ `session`ì„ ì‚¬ìš©í•´ì„œ ì–´ë–»ê²Œ ë¡œê·¸ì¸ ìœ ì§€ê°€ ë˜ì–´ ìˆëŠ”ì§€, ìœ ì € ë°ì´í„°ëŠ” ì–´ë–»ê²Œ ê°€ì ¸ì™€ì„œ ë¿Œë¦¬ëŠ”ì§€ ë‹¤ìŒ ì‹œê°„ì— ì•Œì•„ë³´ì.

> 22.06.07 ê¸°ì¤€, ìµœê·¼ ì‘ì„±ë˜ëŠ” í¬ìŠ¤íŒ…ì€ ì‹œê°„ ì‚¬ì •ìƒ ë¹ ë¥´ê²Œ ê¸°ë¡í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤. ê³„ì†í•´ì„œ ì‰¬ëŠ” ë‚ ì— ì—…ë°ì´íŠ¸ ì˜ˆì •ì´ë‹ˆ ì°¸ê³ ë°”ëë‹ˆë‹¤ ğŸ™‡â€â™‚ï¸

---

ğŸ“š í•¨ê»˜ ë³´ë©´ ì¢‹ì€ ë‚´ìš©

[NextAuth.js::Credentials](https://next-auth.js.org/configuration/providers/credentials)

[NextAuth.js::Callbacks](https://next-auth.js.org/configuration/callbacks)

[NextAuth.js::REST API](https://next-auth.js.org/getting-started/rest-api)
