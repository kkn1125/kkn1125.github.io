---
slug: "/webrtc02"
layout: post
date: 2022-07-06 22:12:46 +0900
title: "[WEBRTC] node.js express + React + WebRTC + WebSocket í™˜ê²½ êµ¬ì¶•í•˜ê¸° 02"
author: Kimson
categories: [software]
image: /images/post/covers/TIL-center.png
tags: [notion, til]
description: "ì–‘ë°©í–¥ ì˜ìƒì¶œë ¥ì„ í•´ë³´ì

íšŒì‚¬ì—ì„œ ì˜ìƒê´€ë ¨ í”„ë¡œì íŠ¸ë¡œ ì¸í•´ `ffmpeg`ì™€ `webrtc`ë¥¼ ì²˜ìŒ ì ‘í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. `WebRTC` ë‚´ìš©ì´ ì›Œë‚™ì— ì–´ë µê³  ë ˆí¼ëŸ°ìŠ¤ë„ ì ì€ë°ë‹¤ ê¸°ìˆ  ë°œí‘œìë£Œê°€ ì¦ë¹„í•  ë¿ ì˜ìƒê°•ì¢ŒëŠ” ì™¸êµ­ ë¶„ë“¤ì´ ì˜¬ë¦° ê²ƒì´ ì „ë¶€ì˜€ìŠµë‹ˆë‹¤.

ë¬¼ë¡  ë” ì°¾ì•„ë³´ë©´ ìˆì„ ìˆ˜ ìˆì§€ë§Œ ë‹¨ê¸°ê°„ì— ë¹¨ë¦¬ ìµí˜€ì•¼í•˜ëŠ”ê²Œ ìŠ¬í”ˆ í˜„ì‹¤...

ì´ê²ƒì €ê²ƒ ì°¸ê³ í•œ ê²ƒë“¤ê³¼ ì‘ì—…í•œ ê²°ê³¼ë¬¼ê³¼ ì‘ì—…í•˜ë©´ì„œ ê²ªì€ ì˜¤ë¥˜ ìƒí™© ë° ë¬¸ì œí•´ê²°ì„ ê¸°ë¡í•˜ë ¤í•©ë‹ˆë‹¤."
featured: true
hidden: false
rating: 4.5
toc: true
profile: false
istop: true
keysum: false
keywords: ""
published: true
---

# ì–‘ë°©í–¥ ì˜ìƒì¶œë ¥ì„ í•´ë³´ì

íšŒì‚¬ì—ì„œ ì˜ìƒê´€ë ¨ í”„ë¡œì íŠ¸ë¡œ ì¸í•´ `ffmpeg`ì™€ `webrtc`ë¥¼ ì²˜ìŒ ì ‘í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. `WebRTC` ë‚´ìš©ì´ ì›Œë‚™ì— ì–´ë µê³  ë ˆí¼ëŸ°ìŠ¤ë„ ì ì€ë°ë‹¤ ê¸°ìˆ  ë°œí‘œìë£Œê°€ ì¦ë¹„í•  ë¿ ì˜ìƒê°•ì¢ŒëŠ” ì™¸êµ­ ë¶„ë“¤ì´ ì˜¬ë¦° ê²ƒì´ ì „ë¶€ì˜€ìŠµë‹ˆë‹¤.

ë¬¼ë¡  ë” ì°¾ì•„ë³´ë©´ ìˆì„ ìˆ˜ ìˆì§€ë§Œ ë‹¨ê¸°ê°„ì— ë¹¨ë¦¬ ìµí˜€ì•¼í•˜ëŠ”ê²Œ ìŠ¬í”ˆ í˜„ì‹¤...

ì´ê²ƒì €ê²ƒ ì°¸ê³ í•œ ê²ƒë“¤ê³¼ ì‘ì—…í•œ ê²°ê³¼ë¬¼ê³¼ ì‘ì—…í•˜ë©´ì„œ ê²ªì€ ì˜¤ë¥˜ ìƒí™© ë° ë¬¸ì œí•´ê²°ì„ ê¸°ë¡í•˜ë ¤í•©ë‹ˆë‹¤.

## WebRTC APIë¥¼ ë“¤ì—¬ë‹¤ ë³´ì

[ì´ì „ í¬ìŠ¤íŒ…](https://kkn1125.github.io/webrtc01)ì—ì„œ reactì—ì„œ webrtcë¥¼ ì‚¬ìš©í•´ì„œ ê°„ë‹¨í•œ ì˜ìƒì¶œë ¥ê¹Œì§€ í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ì´ë²ˆì—ëŠ” ì±„íŒ…ë£¸ì„ ë§Œë“¤ì–´ ìƒëŒ€ë°©ì´ ì ‘ì†í•˜ë©´ ì„œë¡œ ì˜ìƒì„ ì¶œë ¥í•˜ëŠ” ê²ƒì„ êµ¬í˜„í•˜ë ¤í•©ë‹ˆë‹¤.

ë¨¼ì € ì•Œì•„ì•¼í•˜ëŠ” ê²ƒì€ `WebRTC API`ì— ê´€í•œ ë‚´ìš©ì¸ë°ìš”, `WebRTC API`ëŠ” ê·¸ë ‡ê²Œ ë§ì§€ ì•Šê³  `MDN web docs`ì— ì„¤ëª…ì´ êµ‰ì¥íˆ ì˜ ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ, ì²˜ìŒ ì ‘í•  ë•ŒëŠ” ë‹¹ì—°íˆ ì˜ ì •ë¦¬ëœ ë§ë„ ì–´ë µê²Œ ëŠê»´ì§€ê¸° ë§ˆë ¨ì´ì§€ìš”.

í¬ìŠ¤íŒ… ë‚´ìš©ì´ ì£¼ê´€ì ì¸ ê³µë¶€ íŒ¨í„´ì„ ê¸°ì¤€ìœ¼ë¡œ í•˜ê¸° ë•Œë¬¸ì— ë‚´ìš©ì´ ë’¤ì£½ë°•ì£½ì´ì–´ë„ ì–‘í•´ë°”ëë‹ˆë‹¤ ğŸ¥²

### RTCPeerConnection

ì œì¼ ì¤‘ìš”í•œ ì¸í„°í˜ì´ìŠ¤ë¼ê³  ë§í•˜ê³  ì‹¶ì€ ë…€ì„ì…ë‹ˆë‹¤. `RTCPeerConnection` ìƒì„±ìë¥¼ í†µí•´ ë§Œë“  ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìì£¼ ë‹¤ë£° ê²ƒ ì…ë‹ˆë‹¤. ì œì¼ í•µì‹¬ì´ë¼ê³  í•´ë„ ê³¼ì–¸ì´ ì•„ë‹ˆë¼ ìƒê°í•©ë‹ˆë‹¤.

```js
const pc = new RTCPeerConnection();
```

ìœ„ì™€ ê°™ì´ ìƒì„±ìë¥¼ í†µí•´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“œëŠ”ë°ìš”, ì´ë•Œ pc ë³€ìˆ˜ëŠ” datachannelì´ë‚˜ ì´ë²¤íŠ¸, icecandidateë¥¼ ì¶”ê°€ í•˜ëŠ” ë“±ì˜ í–‰ìœ„ë¥¼ í•˜ê²Œ í•´ì£¼ëŠ” í•µì‹¬ì ì¸ ê¸°ëŠ¥ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤. WebRTCëŠ” ì‹œê·¸ë„ë§ ì„œë²„ë¥¼ í•„ìš”ë¡œ í•˜ëŠ”ë° ì‹œê·¸ë„ë§ì„ ì§€ì›í•˜ì§€ ì•Šìœ¼ë©°, socket.ioë¼ëŠ” WebSocket libraryë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

ë¯¸ë””ì–´ë¥¼ ì£¼ê³  ë°›ëŠ” íë¦„ì„ ì•Œë©´ ë‚˜ì¤‘ì— ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ë¬´ì—‡ë¶€í„° í•´ì•¼í•˜ëŠ”ì§€ ê°ì´ ì¡íˆê¸° ë•Œë¬¸ì— íë¦„ë„ë¥¼ ë³´ê² ìŠµë‹ˆë‹¤.

<figure class="text-center">
<span class="w-inline-block">
   <img src="https://user-images.githubusercontent.com/71887242/177593218-5a772304-d7c0-4ac7-96bb-73993d4ed8bd.png" alt="sample" title="sample">
   <figcaption>íë¦„ë„</figcaption>
</span>
</figure>

ìˆœì„œë¥¼ ë‚˜ì—´í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1. ìœ ì €ê°€ ì ‘ì†í•œë‹¤.
2. getUserMediaë¡œ ì¹´ë©”ë¼ ê¶Œí•œ ìš”ì²­ì„ í•œë‹¤.
3. peerConnectionì—ì„œ localDescriptionì„ ì‘ì„±í•œë‹¤.
4. dataChannel ìƒì„±
5. createOffer
6. sendOffer
7. socketì—ì„œ ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ broadcastë¡œ offerë¥¼ ì „ë‹¬í•œë‹¤.
8. ë°›ì€ offerë¥¼ remoteDescriptionì— ë„£ëŠ”ë‹¤.
9. createAnswer
10. localDescriptionì„ ì‘ì„±í•œë‹¤.
11. sendAnswer
12. socketì—ì„œ ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ broadcastë¡œ answerë¥¼ ì „ë‹¬í•œë‹¤.
13. ë°›ì€ answerë¥¼ remoteDescriptionì— ë„£ëŠ”ë‹¤.
14. iceCandidate ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ëŠ” ì˜ì—­ì—ì„œ socketì— iceCandidatesë¥¼ ì „ì†¡í•œë‹¤.
15. onTrack ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ê³ , í•´ë‹¹ íŠ¸ë™ì„ remoteVideoì˜ srcObjectì— ë„£ëŠ”ë‹¤.
16. ë‹¤ë¥¸ ì‚¬ìš©ì ë˜í•œ iceCandidates ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ìƒëŒ€ë°©ì—ê²Œ iceCandidatesë¥¼ ì „ì†¡í•œë‹¤.
17. ê²°ê³¼ì ìœ¼ë¡œ ì„œë¡œ ì˜ìƒ êµí™˜ì´ ë˜ì–´ ì–‘ë°©í–¥ ì¶œë ¥ì´ ëœë‹¤.

ì•„ì§ ì •ë¦¬ê°€ ì™„ì „íˆ ëœ ë‚´ìš©ì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ìì„¸í•œ ìë£ŒëŠ” ê³µì‹ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì‹œëŠ” ê²ƒì„ ê¶Œì¥ë“œë¦¬ë©°, ê°œë…ì ìœ¼ë¡œ ë³´ìë©´ ì„œë¡œ í•˜ë‚˜ì”© êµí™˜í•œë‹¤ê³  ìƒê°í•˜ì‹œëŠ” ê²Œ ì´í•´ë¥¼ ë„ìš¸ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

offerê°€ ë§Œë“¤ì–´ì§€ê³  ì „ì†¡ë˜ë©´ answerë¡œ ì‘ë‹µí•´ì£¼ê³ , ê°ì localDescription, remoteDescriptionì´ ì‘ì„±ë˜ë©´ ì´í›„ iceCandidateë¥¼ ì£¼ê³  ë°›ìŠµë‹ˆë‹¤.

ê·¸ ê³¼ì •ì—ì„œ onTrack ì´ë²¤íŠ¸ë¥¼ ì„¤ì •í•´ì„œ ê° remoteVideoì— ì¶œë ¥ì‹œí‚¤ëŠ” íë¦„ì…ë‹ˆë‹¤.

## ì½”ë“œë¡œ ì‘ì„±í•˜ë©´ì„œ ìµíˆê¸°

ê°œë°œí™˜ê²½ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. ì•„ë˜ ì†Œê°œë˜ëŠ” ì¢…ì†ì„± ì¤‘ ëª¨ë¥´ëŠ”ê²Œ ìˆë‹¤ë©´ ì„ í–‰ìœ¼ë¡œ ë³´ê³  ì˜¤ì‹œëŠ” ê²ƒì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤. ì‘ì„±ë˜ëŠ” íë¦„ì„ ë³´ëŠ” ê²ƒì— ì§‘ì¤‘í•  ê²ƒì´ê¸° ë–„ë¬¸ì— ë¬´ìŠ¨ ë™ì‘ìœ¼ë¡œ í•˜ê³  ì–´ë–¤ ê¸°ëŠ¥ì¸ì§€ ì–¸ê¸‰ í•˜ì§€ ì•Šì„ ê²ƒ ì„ì„ ë¯¸ë¦¬ ì•Œë¦½ë‹ˆë‹¤.

### ê³µí†µ

- vscode
- yarn

### ì„œë²„ ì¸¡(back)

- concurrently
- nodemon
- dotenv
- cors
- express
- socket.io

### í´ë¼ì´ì–¸íŠ¸ ì¸¡(front)

- axios
- @emotion/[core, css, react]
- styled-components
- redux
- @reduxjs/toolkit
- http-proxy-middleware
- dotenv
- socket.io-client

## ì„¸íŒ…

### í´ë¼ì´ì–¸íŠ¸ ì„¸íŒ…

```bash
mkdir webrtc-react-base && cd "$_"
```

ì‘ì—… í´ë”ë¥¼ ìƒì„±í•˜ê³  ì´ë™í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ë‚˜ì„œ ì•„ë˜ ëª…ë ¹ì¤„ë¡œ í•„ìš”í•œ ì¢…ì†ì„±ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```bash
yarn add express dotenv nodemon concurrently socket.io cors
```

ê·¸ë¦¬ê³  server.jsë¥¼ ìƒì„±í•˜ê³  clientë””ë ‰í† ë¦¬ë„ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤. ë‘˜ ë‹¤ ë£¨íŠ¸ ê²½ë¡œ ì•„ë˜ì— ìƒì„±í•©ë‹ˆë‹¤. clientë¡œ ì´ë™í•´ì„œ í´ë¼ì´ì–¸íŠ¸ë‹¨ì—ì„œ í•„ìš”í•œ ì¢…ì†ì„±ë“¤ì„ ì„¤ì¹˜í•´ì¤ë‹ˆë‹¤.

craë¡œ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê³  ë‚˜ë¨¸ì§€ ì¢…ì†ì„±ë„ ì„¤ì¹˜í•´ì¤ë‹ˆë‹¤. (emotionì´ë‚˜ styled-componentsëŠ” ì„ íƒ)

```bash
yarn create react-app .
yarn add @emotion/react styled-components axios styled-components redux @reduxjs/toolkit http-proxy-middleware dotenv socket.io-client
```

ê·¸ë¦¬ê³  ì„œë²„ë¥¼ ì—´ë•Œ httpê°€ ì•„ë‹Œ httpsë¡œ ì—´ì–´ì•¼ ë  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. ì´ìœ ëŠ” ì¹´ë©”ë¼ ì¥ì¹˜ê°€ ìˆëŠ” ê¸°ê¸°ì—ì„œ ì‹¤í•¼ í•  ë•Œ ê¶Œí•œì„ ìš”ì²­í•˜ëŠ” ë¶€ë¶„ì—ì„œ httpsê°€ ì•„ë‹Œ httpì—ì„œëŠ” ë³´ì•ˆìƒ ì´ìœ ë¡œ ì¹´ë©”ë¼ ê¸°ëŠ¥ì´ ë™ì‘í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

í´ë¼ì´ì–¸íŠ¸ ë¶€ë¶„ì€ envíŒŒì¼ì— httpsì„¤ì •ë§Œ í•´ë‘ë©´ ë©ë‹ˆë‹¤ë§Œ ì„œë²„ ë‹¨ì—ëŠ” ì¸ì¦ì„œ ë°œê¸‰ì´ í•„ìš”í•©ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ ë‹¨ì— .envíŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒê³¼ ê°™ì´ ê¸°ì…í•©ë‹ˆë‹¤.

```properties
PORT=3000 # êµ³ì´ ì•ˆí•´ë„ ë©ë‹ˆë‹¤.
HOST=localhost # êµ³ì´ ì•ˆí•´ë„ ë©ë‹ˆë‹¤.

HTTPS=true
```

apië¥¼ ë§Œë“¤ ì˜ˆì •ì´ë¼ë©´ í¬íŠ¸ê°€ ë‹¤ë¥¸ ì„œë²„ì™€ í†µì‹ í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— í”„ë¡ì‹œ ì„¤ì •ë„ í•´ì¤ë‹ˆë‹¤. ì´ í¬ìŠ¤íŒ…ì—ì„œ í•„ìˆ˜ëŠ” ì•„ë‹ˆë‹ˆ ê±´ë„ˆë›°ì…”ë„ ìƒê´€ì—†ìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ ë‹¨ì§€ ì—°ê²° ì˜ ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ ìš©ë„ë¡œë§Œ ì“°ì´ê³  ê·¸ ì™¸ ì‚¬ìš©ë˜ì§€ ì•Šì„ ì˜ˆì •ì…ë‹ˆë‹¤.

```javascript
// src/setupProxy.js

const { createProxyMiddleware } = require("http-proxy-middleware");

module.exports = function (app) {
  app.use(
    "/api",
    createProxyMiddleware({
      target: "https://localhost:4000",
      changeOrigin: true,
    })
  );
};
```

ì¸ì¦ì„œë¥¼ ë°œê¸‰í•˜ëŠ” ì ˆì°¨ëŠ” í¬ìŠ¤íŒ… í•˜ë‹¨ ë§í¬ë¥¼ ì°¸ì¡°í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤. ê·¸ë¦¬ê³  httpsë¡œ ì„œë²„ë¥¼ ì—´ê¸° ìœ„í•´ .env í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

```properties
# .env
KEY=localhost-key.pem
CERT=localhost.pem
SERVER_HOST=localhost
SERVER_PORT=4000
```

ë§ˆì§€ë§‰ìœ¼ë¡œ package.jsonì— ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ë¥¼ ê°œë°œí•  ë•Œ ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‹¤í–‰í•´ì£¼ëŠ” concurrently ì„¤ì •ì„ í•´ì£¼ë©´ ì„¸íŒ…ì€ ëë‚©ë‹ˆë‹¤.

```json
{
  "scripts": {
    // ì¶”ê°€
    "server": "nodemon server.js",
    "client": "cd client/ && yarn start",
    "start": "concurrently --kill-others-on-fail \"yarn server\" \"yarn client\""
  },
  "dependencies": {
    "concurrently": "^7.2.2",
    "cors": "^2.8.5",
    "dotenv": "^16.0.1",
    "express": "^4.18.1",
    "nodemon": "^2.0.19",
    "socket.io": "^4.5.1"
  }
}
```

ì„¸íŒ…ì´ ë˜ê³  ë‚˜ë©´ ì•„ë˜ì™€ ê°™ì€ í´ë”êµ¬ì¡°ê°€ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

<figure class="text-center">
<span class="w-inline-block">
   <img src="https://user-images.githubusercontent.com/71887242/178133552-ffb54a58-93d1-4fa9-b30e-8847ead85e43.png" alt="sample" title="sample">
   <figcaption>í´ë”êµ¬ì¡°</figcaption>
</span>
</figure>

## ì„œë²„ ì†Œì¼“ ë¶€ë¶„ ì‘ì„±

```javascript
// server.js

const fs = require("fs");
const cors = require("cors");
const https = require("https");
const express = require("express");
const { Server } = require("socket.io");
const app = express();

require("dotenv").config();

const { SERVER_HOST, SERVER_PORT, CERT, KEY } = process.env;

// ###########################
// #      server config      #
// ###########################
const serverConfig = {
  key: fs.readFileSync(__dirname + "/" + KEY),
  cert: fs.readFileSync(__dirname + "/" + CERT),
};

// ##################################
// #      socket server config      #
// ##################################
const socketServerConfig = {
  cors: {
    origin: `*`,
  },
};

// ###########################################
// #      create server & socket server      #
// ###########################################
const server = https.createServer(serverConfig, app);
const io = new Server(server, socketServerConfig);

// #############################
// #      server settings      #
// #############################
app.use(cors());
app.use(express.json());
app.use("/", (req, res) => {
  res.send("server test");
});

server.listen(SERVER_PORT, () => {
  console.log(`listening on https://${SERVER_HOST}:${SERVER_PORT}`);
});

// ####################################
// #      socket server settings      #
// ####################################
let roomList = {};
io.on("connection", (socket) => {
  // room id ì €ì¥ ë³€ìˆ˜
  let room = "";

  const roomCount = (list) => list[room].length;

  // user ì°¸ì—¬
  socket.on("join", (msg) => {
    // room id ë°›ì•„ ì €ì¥
    room = msg;

    // roomListê°€ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ í• ë‹¹
    if (!roomList[room]) {
      roomList[room] = [];
    }

    const check = consoleCheck(room, socket.id, roomCount);
    // roomListì˜ í•´ë‹¹ ë°©ì— ìœ ì € ì†Œì¼“ì•„ì´ë””ê°€ ì—†ìœ¼ë©´ ì¶”ê°€
    if (roomList[room].indexOf(socket.id) === -1) {
      roomList[room].push(socket.id);
    }

    // í™•ì¸ ì½˜ì†”
    consoleCheck.log(room, socket.id, "IN");
    consoleCheck.log(room, socket.id, roomCount);

    // roomì— socketì„ joinì‹œí‚´
    socket.join(room);
    // í•´ë‹¹ ë°©ì˜ ë³¸ì¸ ì™¸ ëª¨ë‘ì—ê²Œ ë©”ì„¸ì§€ ë‚ ë¦¼
    socket.broadcast.to(room).emit("message", check);

    // ë³¸ì¸ì—ê²Œ ë©”ì„¸ì§€
    io.emit("userInRoom", roomList[room].length);
    // ë³¸ì¸ ì™¸ ëª¨ë‘ì—ê²Œ ë©”ì„¸ì§€
    socket.broadcast.to(room).emit("userInRoom", roomList[room].length);
  });

  // offer, answer, icecandidate êµí™˜
  socket.on("message", (message) => {
    // icecandidate ë“± êµí™˜
    socket.broadcast.to(room).emit("message", message);
  });

  // ì˜ìƒ ëŠì–´ì¡Œì„ ë•Œ
  socket.on("disconnect", () => {
    consoleCheck.log(room, socket.id, 2);
    roomList[room] = roomList[room].filter(
      (socketId) => socketId !== socket.id
    );

    socket.broadcast.to(room).emit("userInRoom", roomList[room].length);
  });
});

const MESSAGE = new (function (TYPES) {
  const root = this;
  TYPES.map((_, __) => (root[(root[_] = __)] = _));
})(["JOIN", "IN", "OUT"]);

function consoleCheck(roomId, userId, message) {
  if (typeof message !== "function") {
    return `room:${roomId} / user-id:${userId} / [${MESSAGE[message]}]`;
  } else {
    return `room:${roomId} / user-id:${userId} / [total-users: ${message(
      roomList
    )}]`;
  }
}

consoleCheck.log = function (roomId, userId, message) {
  if (typeof message !== "function") {
    console.log(`room:${roomId} / user-id:${userId} / [${MESSAGE[message]}]`);
  } else {
    console.log(
      `room:${roomId} / user-id:${userId} / [total-users: ${message(roomList)}]`
    );
  }
};
```

## í´ë¼ì´ì–¸íŠ¸ í˜ì´ì§€ ë° ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸ ì‘ì„±

index.jsë¶€í„° ì‘ì„±í•©ë‹ˆë‹¤. reduxë¥¼ ì‚¬ìš©í•´ì„œ roomì •ë³´ë¥¼ localStorageì— ì¼ê³  ì“°ëŠ” ì‘ì—…ì„ í•©ë‹ˆë‹¤. ìŠ¤íƒ€ì¼ì„ ì¶”ê°€í•˜ëŠ” ë“±ì˜ ì‘ì—…ì´ ìˆì–´ ì¡°ê¸ˆ ì½”ë“œ ì–‘ì´ ìì˜í•˜ê²Œ ë§ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```javascript
// index.js
import React from "react";
import ReactDOM from "react-dom/client";
import App from "./App";
import reportWebVitals from "./reportWebVitals";
import { createGlobalStyle } from "styled-components";
import { BrowserRouter } from "react-router-dom";
import { Provider } from "react-redux";
import { configureStore } from "@reduxjs/toolkit";
import rootReducers from "./store";
import logger from "redux-logger";

const Global = createGlobalStyle`
  html, body, #root {
    height: 100%;
  } 
  
  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
      'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
      sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  code {
    font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
      monospace;
  }
`;

const store = configureStore({
  reducer: rootReducers,
  middleware: [logger],
});

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(
  <React.StrictMode>
    <Global />
    <Provider store={store}>
      <BrowserRouter>
        <App />
      </BrowserRouter>
    </Provider>
  </React.StrictMode>
);

// If you want to start measuring performance in your app, pass a function
// to log results (for example: reportWebVitals(console.log))
// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals
reportWebVitals();
```

reducerë¥¼ ì •ì˜í•˜ëŠ” moduleê³¼ combineReducers ë‚´ìš©ì…ë‹ˆë‹¤.

```javascript
// src/modules/room.js
const ADD = "room/ADD";
const READ = "room/READ";
const SAVE = "room/SAVE";
const REMOVE = "room/REMOVE";

export const add = (room) => ({ type: ADD, room });
export const read = () => ({ type: READ });
export const save = () => ({ type: SAVE });
export const remove = (room) => ({ type: REMOVE, room });

const initialState = [];

export default function room(state = initialState, action) {
  switch (action.type) {
    case ADD:
      if (state.indexOf(action.room) === -1) {
        return state.concat(action.room);
      } else {
        return state;
      }
    case READ:
      const webrtcRoom = () => localStorage.getItem("webrtcRoom");
      if (!webrtcRoom()) localStorage.setItem("webrtcRoom", "[]");
      return JSON.parse(webrtcRoom());
    case SAVE:
      localStorage["webrtcRoom"] = JSON.stringify(state);
      return state;
    case REMOVE:
      return state.filter((_) => _ !== action.room);
    default:
      return state;
  }
}
```

```javascript
// src/store/index.js
import { combineReducers } from "redux";
import room from "../modules/room";

const rootReducers = combineReducers({ room });

export default rootReducers;
```

ê·¸ ë‹¤ìŒ, App.jsëŠ” routingì„ í•´ì£¼ëŠ” ì—­í• ë§Œ ì‘ì„±í•´ë‘¡ë‹ˆë‹¤.

```javascript
// src/App.js
import { Routes, Route } from "react-router-dom";
import Home from "./presentations/Home";
import Layout from "./presentations/Layout";
import Room from "./presentations/Room";

function App() {
  return (
    <Routes>
      <Route path='/' element={<Layout />}>
        <Route path='' element={<Home />} />
        <Route path='r/:id' element={<Room />} />
      </Route>
    </Routes>
  );
}

export default App;
```

ì´ì œ ê° í˜ì´ì§€ì™€ ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸ë¥¼ ì •ì˜í•´ì¤ë‹ˆë‹¤.

### Layout

```javascript
// src/presentation/Layout/LayoutBlock.js

import React from "react";
import { useSelector } from "react-redux";
import { Link, Outlet, useLocation, useParams } from "react-router-dom";
import styled, { css } from "styled-components";
import { Container, LayoutBlock, Menu, Nav, Text } from "./Parts";

function Layout() {
  const locate = useLocation();
  const params = useParams();

  const isRoom = locate.pathname.startsWith("/r/");

  const rooms = useSelector((state) => state.room);

  return (
    <LayoutBlock>
      <Nav>
        <Menu to='/' size='large'>
          WebRTC Test
        </Menu>
        {isRoom && <Text size='small'>{params.id} ë²ˆ ë°©</Text>}
        {!isRoom && rooms.length > 0 && (
          <Menu to={`/r/${rooms[rooms.length - 1]}`}>Latest Room â–¶ï¸</Menu>
        )}
      </Nav>
      <Container>
        <Outlet />
      </Container>
    </LayoutBlock>
  );
}

export default Layout;
```

```javascript
// src/presentation/Layout/Parts.js

import { Link } from "react-router-dom";
import styled, { css } from "styled-components";

const fontSize = {
  small: 16,
  normal: 24,
  large: 30,
};

const Container = styled.div`
  width: 80%;
  margin: auto;
  height: 100%;
`;

const NavStyle = css`
  text-decoration: none;
  color: inherit;
  padding: 0.5rem;
  font-weight: 600;
  text-transform: uppercase;
`;

const Text = styled.div`
  ${NavStyle}
  font-size: ${({ size }) => fontSize[size]}px;
`;

const Menu = styled(Link)`
  ${NavStyle}
  ${({ size = "normal" }) =>
    css`
      font-size: ${size === "large" ? 36 : 20}px;
    `}
`;

const Nav = styled.nav`
  padding-left: 2rem;
  padding-right: 2rem;
  position: sticky;
  top: 0;
  right: 0;
  left: 0;
  display: flex;
  justify-content: space-between;
  background-color: #252525e9;
  border-bottom: 1px solid #252525;
  align-items: center;
  z-index: 100;
`;

const LayoutBlock = styled.div`
  background-color: #353535;
  color: white;
  height: 100%;
  overflow: auto;
`;

export { fontSize, Container, NavStyle, Text, Menu, Nav, LayoutBlock };
```

```javascript
// src/presentation/Layout/index.js

export { default } from "./LayoutBlock";
```

### HomePage

ê° í˜ì´ì§€ëŠ” styled componentsì™€ ë¡œì§ì´ ë‹´ê¸´ ì»´í¬ë„ŒíŠ¸ë¡œ ë¶„ë¥˜í•´ì„œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

```javascript
// src/presentation/Home/HomeBlock.js

import React, { useState } from "react";
import { useEffect } from "react";
import { useSelector } from "react-redux";
import { useDispatch } from "react-redux";
import { Link, useNavigate } from "react-router-dom";
import styled from "styled-components";
import { add, read, save } from "../../modules/room";
import { HomeBlock, Hr, Input, List, Room } from "./Parts";

function Home() {
  const [roomId, setRoomId] = useState(Date.now().toString(36));
  const rooms = useSelector((state) => state.room);
  const navigate = useNavigate();
  const dispatch = useDispatch();

  useEffect(() => {
    dispatch(read());
  }, []);

  const handleChange = (e) => {
    setRoomId(e.target.value);
  };

  const handleAddRoomIfNotExists = (e) => {
    const roomId = e.target.value;
    if (e.key === "Enter") {
      dispatch(add(roomId));
      dispatch(save());
      navigate(`/r/${roomId}`);
    }
  };

  return (
    <HomeBlock>
      <Input
        value={roomId}
        onChange={handleChange}
        onKeyDown={handleAddRoomIfNotExists}
      />
      <Hr />
      <List>
        {rooms.map((room) => (
          <Room key={room} id={room} to={`/r/${room}`}>
            ğŸ“‚ {room} ë²ˆ ë°©
          </Room>
        ))}
      </List>
    </HomeBlock>
  );
}

export default Home;
```

```javascript
// src/presentation/Home/Parst.js

import { Link } from "react-router-dom";
import styled from "styled-components";

const Hr = styled.div`
  height: 1px;
  background: #5d5d5d;
  margin-top: 1rem;
  margin-bottom: 1rem;
`;

const Input = styled.input`
  border: 1px solid #dedede;
  border-radius: 0;
  font-size: 1.2rem;
  padding: 0.5rem 1rem;
`;

const Room = styled(Link)`
  padding: 1rem;
`;

const List = styled.div`
  display: flex;
  flex-direction: column;
  & ${Room} {
    color: inherit;
    text-decoration: none;
    border-bottom: 1px solid #dedede;
    &:last-child {
      border-bottom: none;
    }
    &:hover {
      background-color: #ffffff12;
    }
  }
`;

const HomeBlock = styled.div`
  display: flex;
  flex-direction: column;
  padding: 1rem;
`;

export { Hr, Input, Room, List, HomeBlock };
```

```javascript
// presentation/Home/index.js

export { default } from "./HomeBlock";
```

### RoomPage

```javascript
// src/presentation/Room/RoomBlock.js

import React, { useState } from "react";
import {
  BsEyeFill,
  BsEyeSlashFill,
  BsMicFill,
  BsMicMuteFill,
} from "react-icons/bs";

import { ImExit } from "react-icons/im";
import { useNavigate } from "react-router-dom";
import {
  Button,
  LocalVideo,
  RemoteVideo,
  RoomBlock,
  Tools,
  Wrap,
} from "./Parts";

function Room() {
  const [toggleMic, setToggleMic] = useState(true);
  const [toggleShow, setToggleShow] = useState(true);
  const navigate = useNavigate();

  const handleToggleMic = (e) => {
    setToggleMic(!toggleMic);
  };
  const handleToggleShow = (e) => {
    setToggleShow(!toggleShow);
  };
  const handleExit = (e) => {
    navigate("/");
  };

  return (
    <RoomBlock>
      <Wrap>
        <RemoteVideo autoPlay/>
        <LocalVideo autoPlay/>
      </Wrap>
      <Tools>
        <Button onClick={handleToggleMic}>
          {toggleMic ? <BsMicFill /> : <BsMicMuteFill />}
        </Button>
        <Button onClick={handleToggleShow}>
          {toggleShow ? <BsEyeFill /> : <BsEyeSlashFill />}
        </Button>
        <Button onClick={handleExit}>
          <ImExit />
        </Button>
      </Tools>
    </RoomBlock>
  );
}

export default Room;
```

```javascript
// src/presentation/Room/Parts.js

import styled, { css } from "styled-components";

const videoStyles = css`
  position: absolute;
`;

const Button = styled.button`
  border: none;
  outline: none;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: #252525;
  width: 65px;
  height: 65px;
  border-radius: 50%;
  font-size: 25px;
  box-shadow: 0 0 10px 0 #ffffff56;
  color: inherit;
  &:hover {
    background-color: #353535;
    box-shadow: 0 0 15px 0 #ffffff95;
  }
  &:active {
    background-color: #555555;
    box-shadow: 0 0 15px 0 #ffffff95;
  }
  & svg {
    color: inherit;
    display: block;
    min-width: 25px;
  }
`;

const Tools = styled.div`
  position: absolute;
  display: flex;
  gap: 2.5rem;
  justify-content: center;
  bottom: 3rem;
  z-index: 500;
`;

const LocalVideo = styled.video`
  ${videoStyles}
  width: 960px;
  height: 560px;
  background-color: grey;
`;

const RemoteVideo = styled.video`
  ${videoStyles}
  width: 250px;
  height: 160px;
  z-index: 50;
  left: 0;
  background-color: black;
`;

const Wrap = styled.div`
  position: relative;
  width: 960px;
  flex: 1;
  display: flex;
  justify-content: center;
`;

const RoomBlock = styled.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100%;
`;

export { videoStyles, Button, Tools, LocalVideo, RemoteVideo, Wrap, RoomBlock };
```

```javascript
// src/presentation/Room/index.js

export { default } from "./RoomBlock";
```

## RTCPeerConnection ì„¤ì •

ì´ì œë¶€í„°ê°€ ì¤‘ìš”í•œ ë©”ì¸ ì‘ì—…ì…ë‹ˆë‹¤. ë³¸ì¸ì˜ ì˜ìƒë§Œ ë„ìš°ëŠ” ê²ƒì€ RTCPeerConnection APIê°€ ê°œì…í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì–‘ë°©í–¥ìœ¼ë¡œ ì˜ìƒì„ ì£¼ê³ ë°›ì„ ë•ŒëŠ” RTCPeerConnectionê³¼ Socketì„œë²„ê°€ í•„ìš”í•©ë‹ˆë‹¤.

### ë‚´ ì˜ìƒ ë„ìš°ê¸°

RoomPageì—ì„œ ë¡œì§ì„ ì¶”ê°€í•  ê²ƒ ì…ë‹ˆë‹¤. ì ì  ì½”ë“œê°€ ëŠ˜ì–´ë‚˜ê¸° ë–„ë¬¸ì— ì‘ì„±ë˜ì—ˆë˜ ì´ì „ ì½”ë“œëŠ” ìŠ¤í‚µí•´ì„œ ì ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```javascript
// src/presentations/Room/RoomBlock.js

// ...

import { useNavigate, useParams } from "react-router-dom";
import { useDispatch } from "react-redux";
import { io } from "socket.io-client";

const constraints = {
  video: true,
  audio: false,
};

let getUserMedia,
  socket,
  dataChannel,
  pc,
  localStream,
  remoteStream,
  saveCounter;

function Room() {
  // ... state, navigate, handler

  // media
  const [countUser, setCountUser] = useState();
  const dispatch = useDispatch();
  const params = useParams();
  const localVideo = useRef();
  const remoteVideo = useRef();

  const handleUserMediaError = (e) => {};

  useEffect(() => {
    // ì¹´ë©”ë¼ ê¶Œí•œ ìš”ì²­
    // getUserMedia
    getUserMedia = navigator.mediaDevices
      .getUserMedia(constraints)
      .then((stream) => {
        localVideo.current.srcObject = localStream = stream;
        console.log("local stream", stream);
        // addStream
        stream.getTracks().forEach((track) => pc.addTrack(track, stream));
      })
      .catch(handleUserMediaError);
  }, []);

  return (
    <RoomBlock>
      <Wrap>
        <RemoteVideo ref={remoteVideo} autoPlay/>
        <LocalVideo ref={localVideo} autoPlay/>
      </Wrap>
      <Tools>
        ...
      </Tools>
    </RoomBlock>
  );
}
```

getUserMediaë¡œ ì¹´ë©”ë¼ê¶Œí•œ ìš”ì²­ì´ ê°ˆ ê²ƒì´ê³ , ì•„ë˜ì™€ ê°™ì´ í™”ë©´ì´ ì¶œë ¥ ë˜ë©´ ì„±ê³µì…ë‹ˆë‹¤.

<figure class="text-center">
<span class="w-inline-block">
   <img src="https://user-images.githubusercontent.com/71887242/178299921-8f9e6747-5cd8-4c57-ae4e-1d4202016a64.png" alt="sample" title="sample">
   <figcaption>ë¹„ë””ì˜¤ ì—°ê²°</figcaption>
</span>
</figure>

### ìƒëŒ€ ì˜ìƒ ë„ìš°ê¸°

ì•ì„œ íë¦„ë„ì—ì„œ ë´¤ë˜ ì´ë¯¸ì§€ë¥¼ ì°¸ê³ í•˜ë©´ì„œ ë§Œë“¤ë©´ ë”ìš± ì¢‹ìŠµë‹ˆë‹¤. ì´ì œë¶€í„° ì†Œì¼“ì„œë²„ì™€ í†µì‹ í•˜ë©´ì„œ icecandidateë‚˜ offer, answerë¥¼ ì£¼ê³  ë°›ìœ¼ë©´ì„œ trackì„ ì–»ì–´ì„œ remoteVideoì— streamì„ ì €ì¥í•˜ì—¬ ìƒëŒ€ ì˜ìƒì„ ë„ìš°ê² ìŠµë‹ˆë‹¤. í° ê³¨ìëŠ” ì˜ìƒ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ëŠ” ê²ƒì…ë‹ˆë‹¤.

```javascript
// src/presentations/Room/RoomBlock.js

// ...

// constraints, getUserMedia, socket ...

function Room() {
  // ... state, navigate, handler

  // media ...

  const handleUserMediaError = (e) => {};

  useEffect(() => {
    socket = io("https://localhost:4000", {
      cors: {
        origin: "*",
      },
    });

    socket.on("connect", () => {
      // ì„œë²„ ì—°ê²° í‘œì‹œ
      socket.emit("join", params.id);
      dispatch(add(params.id));
      dispatch(save());

      init();

      // ì„œë²„ì—ì„œ ì˜¨ ë©”ì„¸ì§€
      socket.on("message", (msg) => {
        switch (msg.type) {
          case "offer":
            pc.setRemoteDescription(new RTCSessionDescription(msg))
              .then(() => pc.createAnswer())
              .then(setDescription)
              .then(sendDescription)
              .catch(handleError);
            break;
          case "answer":
            pc.setRemoteDescription(new RTCSessionDescription(msg));
            break;
          case "candidate":
            pc.addIceCandidate(msg.candidate);
            break;
          default:
            return;
        }
      });

      socket.on("userInRoom", (msg) => {
        console.log("[ì¸ì› ë³€ë™] í˜„ì¬ ì¸ì› ", msg);
        saveCounter = msg;
        setCountUser(msg);
      });
    });

    // ì¹´ë©”ë¼ ê¶Œí•œ ìš”ì²­
    // getUserMedia ...

    return () => {
      socket.disconnect();
    };
  }, []);

  function init() {
    // peerConnection ìƒì„±
    pc = new RTCPeerConnection({
      iceServers: [{ urls: "stun:stun.l.google.com:19302" }],
    });

    pc.onicecandidate = function (e) {
      console.log("onicecandidate", e);
      if (e.candidate) {
        socket.send({
          type: "candidate",
          candidate: e.candidate,
        });
      }
    };

    pc.ontrack = function (e) {
      console.log("ontrack", e);
      remoteVideo.current.srcObject = remoteStream = e.streams[0];
    };

    pc.ondatachannel = function (e) {
      dataChannel = e.channel;
      console.log(localStream.getVideoTracks());
      handleData();
      sendData({
        peerMediaStream: {
          video: localStream.getVideoTracks()[0].enabled,
        },
      });
    };

    getUserMedia.then(attachMedia);
  }

  function attachMedia() {
    dataChannel = pc.createDataChannel("chat");
    handleData();
    pc.createOffer()
      .then(setDescription)
      .then(sendDescription)
      .catch(handleError);
  }

  function handleUserMediaError(e) {
    console.log("handleUserMediaError");
    console.error(e.message);
  }

  function setDescription(offer) {
    return pc.setLocalDescription(offer);
  }
  function sendDescription() {
    socket.send(pc.localDescription);
  }
  function handleError(e) {
    console.log("handleError", e);
  }

  function handleData() {
    dataChannel.onmessage = function (e) {
      console.log("onmessage", e);
    };

    dataChannel.onclose = function (e) {
      console.log("onclose", e);
    };
  }

  function sendData(msg) {
    dataChannel.send(JSON.stringify(msg));
  }


  return (
    <RoomBlock>
      <Wrap>
        <RemoteVideo ref={remoteVideo} autoPlay/>
        <LocalVideo ref={localVideo} autoPlay/>
      </Wrap>
      <Tools>
        ...
      </Tools>
    </RoomBlock>
  );
}
```

ì¶”ê°€ëœ í•¨ìˆ˜ë“¤ì€ ì§€ê¸ˆë¶€í„° íë¦„ì„ í•˜ë‚˜ ì”© ì´ì•¼ê¸° í•  ê²ƒì´ê¸° ë•Œë¬¸ì— êµ³ì´ ì„¤ëª…ì€ í•˜ì§€ ì•Šê² ìŠµë‹ˆë‹¤. ì•ì„œ getUserMediaë³´ë‹¤ ì„ ë‘ë¡œ socketì„ ì—°ê²°í•˜ê³  connectëœ í›„ë¡œ message, userInRoom ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•˜ê³  ìˆìŠµë‹ˆë‹¤.

messageëŠ” offer, answer, candidateë¥¼ ìˆ˜ì‹ í•˜ê³  broadcastë¡œ ë³¸ì¸ ì™¸ ëª¨ë‘ì—ê²Œ ë°ì´í„°ë¥¼ ì£¼ëŠ” ì´ë²¤íŠ¸ì…ë‹ˆë‹¤.

clientì˜ message ì´ë²¤íŠ¸ëŠ” ì„œë²„ì—ì„œ ì˜¨ msgë¥¼ ë°›ê³  switchë¬¸ìœ¼ë¡œ msgì˜ typeì„ ë¶„ê¸°í•©ë‹ˆë‹¤.

offerë©´ remoteDescription - answer - localDescription ìˆœìœ¼ë¡œ ìƒì„±í•˜ê³  ìƒì„±ëœ answerë¥¼ messageì´ë²¤íŠ¸ë¡œ ë‹¤ì‹œ ì„œë²„ì— ì „ì†¡í•©ë‹ˆë‹¤.

ê·¸ëŸ¬ë©´ ì„œë²„ëŠ” ë‹¤ì‹œ clientì—ê²Œ messageë¡œ emití•˜ê³ , ë‹¤ë¥¸ ì‚¬ìš©ìë“¤ì€ messageì´ë²¤íŠ¸ê°€ ë°œìƒí•´ì„œ answerë¥¼ ì „ë‹¬ ë°›ì•„ peerConnectionì˜ remoteDescriptionì— sdpë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

ê·¸ë¦¬ê³  ë§ˆì§€ë§‰ìœ¼ë¡œ candidate ë¶„ê¸°ëŠ” onicecandidate ì´ë²¤íŠ¸ê°€ ë°œìƒí•´ì•¼ ì‘ë™í•˜ëŠ” ë¶„ê¸°ì¸ë°, ì¸ì› ìƒê´€ì—†ì´ icecandidate ì´ë²¤íŠ¸ëŠ” ë°œìƒí•©ë‹ˆë‹¤.

ì¸ì›ì´ ë‘˜ ì´ìƒì´ì–´ì•¼ ì„œë¡œ icecandidateë¥¼ êµí™˜í•˜ê³  ê°ìì˜ peerConnectionì— candidateë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

ê·¸ë ‡ê²Œ ëª¨ë“  êµí™˜ì´ ì´ë£¨ì–´ì§€ê³ ë‚˜ë©´ getUserMediaë¥¼ í†µí•´ ì¹´ë©”ë¼ ì¥ì¹˜ë¥¼ ìš”ì²­í•˜ê³  í•´ë‹¹ streamì„ video íƒœê·¸ì— ì „ë‹¬í•´ì£¼ê³ , peerConnectionì— trackì„ ì¶”ê°€í•˜ë©´ì„œ ontrackì´ë²¤íŠ¸ ë°œìƒ ì‹œ ì„œë¡œ êµí™˜ ë°›ì€ streamë°ì´í„°ë¥¼ remoteVideoì— ì „ë‹¬í•©ë‹ˆë‹¤.

ë‹¤ì†Œ ë¶€ì •í™•í•  ìˆ˜ ìˆìœ¼ë‚˜ ìœ„ì—ì„œ ì´ì•¼ê¸°í•œ êµí™˜ ìˆœì„œë‚˜ ì‘ë™ ë°©ì‹ì˜ í° íë¦„ê³¼ ê³¨ìëŠ” í¬ê²Œ í”ë“¤ë¦¬ì§€ ì•ŠëŠ”ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.

ë‚˜ë¨¸ì§€ í•¨ìˆ˜ëŠ” ìœ„ì˜ ê³¨ìëŒ€ë¡œ ìƒê°í•˜ë©´ì„œ ë³´ë©´ ê¸ˆë°© ì•Œì•„ì±„ì‹œë¦¬ë¼ ìƒê°í•©ë‹ˆë‹¤.

ë‚˜ë¦„ ìµœëŒ€í•œ ì†ŒìŠ¤ì½”ë“œë¥¼ ë‹¤ìŒì–´ ë³´ì•˜ìŠµë‹ˆë‹¤. ì•„ë˜ì— ì •ë¦¬ëœ ì½”ë“œë¥¼ ì €ì¥ì†Œì— ì˜¬ë ¤ë‘ì—ˆìœ¼ë‹ˆ ì°¸ê³  ë°”ëë‹ˆë‹¤.

## ë§ˆë¬´ë¦¬

dondidoë‹˜ì˜ 16ë²„ì „ ì†ŒìŠ¤ì½”ë“œì— ì²˜ìŒ ë³¸ reduxê¹Œì§€ ì„ì—¬ìˆì–´ì„œ ë§ì´ ë‚œí•´í–ˆìŠµë‹ˆë‹¤. WebRTCë„ ìƒì†Œí–ˆê³ , reactë¥¼ ì‹œì‘í•œì§€ ì´ì œ 2ë‹¬ì´ë¼ <del>í•˜ê¸°ê°€ ì‹«ì—ˆìŠµë‹ˆë‹¤.</del> í˜ë“¤ì—ˆìŠµë‹ˆë‹¤.

í˜„ì¬ ë²„ì „ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ë©´ì„œ ì‹œê·¸ë„ë§ì„œë²„ì™€ ì˜ìƒë°ì´í„°ë¥¼ ì£¼ê³  ë°›ëŠ” ì›ë¦¬ë¥¼ ëš«ì–´ì ¸ë¼ ë³´ë©´ì„œ ì„œì„œíˆ ëˆˆì— ì½”ë“œê°€ ìµê³  ì›ë¦¬ê°€ ë¨¸ë¦¬ì— ê·¸ë ¤ì¡ŒìŠµë‹ˆë‹¤.

ì´ì œ ë§‰ ì´í•´ ë˜ì—ˆë‹¤ í•´ì„œ ê¸°ê³ ë§Œì¥í•˜ê¸°ì—” ë„ˆë¬´ë‚˜ ë°”ë‹¥ ìˆ˜ì¤€ì˜ ì´í•´ë„ì™€ í™œìš©ëŠ¥ë ¥ì´ë¼ ì´ë²ˆ ê¸°íšŒì— ì£¼ë ¥ì€ ì•„ë‹ˆì§€ë§Œ í¬í´ ì†Œì¬ë¡œ ì‚¬ìš©í•´ì„œ ì¬ë¯¸ë‚œ ì•„ì´ë””ì–´ë¥¼ ì‹¤í˜„í•˜ê³ ì í•©ë‹ˆë‹¤.

<del>í´ë¡ ì½”ë”© ë§Œì„¸ ğŸ˜Š</del>

> ê¸€ì´ ì¢€ ë„ˆì €ë¶„ í•´ë„ ì–‘í•´ë°”ëë‹ˆë‹¤. ê¸€ ì¬ì£¼ê°€ ì—†ìŠµë‹ˆë‹¤...  
> add: ìŒì†Œê±°, í™”ë©´ ë®¤íŠ¸ ë“±ì€ í† ê¸€ íš¨ê³¼ ì™¸ ì‹¤ì§ˆì  ê¸°ëŠ¥ì€ ì—†ìŒì„ ì•Œë¦½ë‹ˆë‹¤!

---

ğŸ“š í•¨ê»˜ ë³´ë©´ ì¢‹ì€ ë‚´ìš©

[Github kkn1125::WebRTC-react-renew](https://github.com/kkn1125/WebRTC-react-renew)